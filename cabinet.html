<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

</head>

<body>
  <h2>üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
<p>–ü—Ä–∏–≤–µ—Ç, <span id="cabinetUser"></span>!</p>

<h3>üèÜ –ú–æ–∏ –ø–æ–±–µ–¥—ã</h3>
<table id="myWinsTable" border="1" width="100%">
  <thead>
    <tr>
      <th>–õ–æ—Ç</th>
      <th>–°—Ç–∞–≤–∫–∞</th>
      <th>–î–∞—Ç–∞</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button class="btn-download" onclick="downloadMyWins()">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –ø–æ–±–µ–¥—ã (Excel)</button>



    <br />
    <a href="feedback.html">‚úâÔ∏è –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a> |
    
    
 
  </div>
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<div style="margin-top:20px;">
  <!-- ‚Ü© –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∞—É–∫—Ü–∏–æ–Ω –±–µ–∑ –≤—ã—Ö–æ–¥–∞ -->
  <a href="index.html?from=cabinet" class="btn">‚Üê –ù–∞–∑–∞–¥</a>

  <a href="archive.html" class="btn" style="background:#6c757d;">üóÇÔ∏è –ê—Ä—Ö–∏–≤ –ª–æ—Ç–æ–≤</a>

  <!-- üö™ –ü–æ–ª–Ω—ã–π –≤—ã—Ö–æ–¥ -->
  <a href="index.html" class="btn" style="background:#dc3545;" onclick="logout()">üö™ –í—ã–π—Ç–∏</a>
</div>

  
  <script src="auction.js"></script>
  <script>
    // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = JSON.parse(localStorage.getItem('currentUser') || localStorage.getItem('auctionUser'));
    if (!user) location.href = 'index.html';
    

    
  // ...—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥...

  function downloadMyWins() {
    const table = document.getElementById('myWinsTable');
    const rows = Array.from(table.querySelectorAll('tr')).slice(1);
    if (rows.length === 0) return alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");

    const data = rows.map(tr => {
      const cells = tr.querySelectorAll('td');
      return {
        "–õ–æ—Ç": cells[0].textContent,
        "–°—Ç–∞–≤–∫–∞": cells[1].textContent,
        "–î–∞—Ç–∞": cells[2].textContent
      };
    });

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "–ú–æ–∏ –ø–æ–±–µ–¥—ã");
    XLSX.writeFile(wb, "my-wins.xlsx");
  }

  function downloadMyBids() {
    const table = document.getElementById('myBidsTable');
    const rows = Array.from(table.querySelectorAll('tr')).slice(1);
    if (rows.length === 0) return alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");

    const data = rows.map(tr => {
      const cells = tr.querySelectorAll('td');
      return {
        "–õ–æ—Ç": cells[0].textContent,
        "–°—Ç–∞–≤–∫–∞": cells[1].textContent,
        "–î–∞—Ç–∞": cells[2].textContent
      };
    });

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "–ú–æ–∏ —Å—Ç–∞–≤–∫–∏");
    XLSX.writeFile(wb, "my-bids.xlsx");
  }



    // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã –∏ —Ç–æ—Å—Ç
    const toast = localStorage.getItem('pendingToast');
    if (toast) {
      showToast(toast);
      localStorage.removeItem('pendingToast');
    }

    function logout() {
      localStorage.removeItem('currentUser');
      localStorage.removeItem('auctionUser');
    }
    function goBackToAuction() {
      localStorage.removeItem('currentUser');
      localStorage.removeItem('auctionUser');
    }
    
    
  </script>
</body>
</html>
