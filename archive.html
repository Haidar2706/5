<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>üóÇÔ∏è –ê—Ä—Ö–∏–≤ –ª–æ—Ç–æ–≤</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h2>üóÇÔ∏è –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –ª–æ—Ç—ã</h2>

    <input type="text" id="searchArchived" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." style="width:100%;margin-bottom:15px;padding:10px;">

    <table id="archiveTable">
      <thead>
        <tr>
          <th>–õ–æ—Ç</th>
          <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
          <th>–†–∞–∑–º–µ—Ä</th>
          <th>–ù–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</th>
          <th>–°—Ç–∞–≤–æ–∫</th>
          <th>–ó–∞–≤–µ—Ä—à—ë–Ω</th>
        </tr>
      </thead>
      <tbody id="archiveBody"></tbody>
    </table>

    <br>
<button class="btn" onclick="downloadArchive()">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ (Excel)</button>
<button class="btn" style="background:#dc3545;" onclick="clearArchive()">üóë –û—á–∏—Å—Ç–∏—Ç—å –∞—Ä—Ö–∏–≤</button>
<button class="btn" style="background:#28a745;" onclick="restoreLastLot()">‚ôªÔ∏è –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –ª–æ—Ç</button>
<a href="index.html?from=cabinet" class="btn">‚Üê –ù–∞–∑–∞–¥</a>



  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    const archived = JSON.parse(localStorage.getItem('archivedLots') || '[]');
    const tbody = document.getElementById('archiveBody');
    const searchInput = document.getElementById('searchArchived');

    function renderArchive(filter = '') {
      tbody.innerHTML = '';

      const filtered = archived.filter(lot => lot.title.toLowerCase().includes(filter.toLowerCase()));

      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">üòî –ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –ª–æ—Ç–æ–≤</td></tr>';
        return;
      }

      filtered.forEach(lot => {
        const date = lot.endTime ? new Date(lot.endTime).toLocaleString() : '‚Äî';
        tbody.innerHTML += `
          <tr>
            <td>${lot.title}</td>
            <td>${lot.category}</td>
            <td>${lot.size || '-'}</td>
            <td>${lot.price} —Å–æ–º</td>
            <td>${lot.bids.length}</td>
            <td>${date}</td>
          </tr>
        `;
      });
    }

    function downloadArchive() {
      if (!archived.length) return alert('–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç');

      const rows = archived.map(lot => ({
        "–õ–æ—Ç": lot.title,
        "–ö–∞—Ç–µ–≥–æ—Ä–∏—è": lot.category,
        "–†–∞–∑–º–µ—Ä": lot.size,
        "–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞": lot.price,
        "–°—Ç–∞–≤–æ–∫": lot.bids.length,
        "–ó–∞–≤–µ—Ä—à—ë–Ω": lot.endTime ? new Date(lot.endTime).toLocaleString() : ''
      }));

      const ws = XLSX.utils.json_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "–ê—Ä—Ö–∏–≤ –ª–æ—Ç–æ–≤");

      XLSX.writeFile(wb, 'archive-lots.xlsx');
    }

    searchInput.addEventListener('input', () => {
      renderArchive(searchInput.value);
    });

    function clearArchive() {
  if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –∞—Ä—Ö–∏–≤?")) return;
  localStorage.removeItem('archivedLots');
  tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">üì≠ –ê—Ä—Ö–∏–≤ –æ—á–∏—â–µ–Ω</td></tr>';
  alert("‚úÖ –ê—Ä—Ö–∏–≤ –æ—á–∏—â–µ–Ω");
}

function restoreLastLot() {
  let archived = JSON.parse(localStorage.getItem('archivedLots') || '[]');
  if (!archived.length) return alert("‚ùå –ê—Ä—Ö–∏–≤ –ø—É—Å—Ç");

  const lot = archived.pop(); // –ø–æ—Å–ª–µ–¥–Ω–∏–π
  const activeLots = JSON.parse(localStorage.getItem('lots') || '[]');
  lot.status = 'active'; // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ
  lot.endTime = Date.now() + 5 * 60 * 1000; // +5 –º–∏–Ω—É—Ç (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å)

  activeLots.push(lot);

  localStorage.setItem('archivedLots', JSON.stringify(archived));
  localStorage.setItem('lots', JSON.stringify(activeLots));

  alert(`‚úÖ –õ–æ—Ç "${lot.title}" –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Å–Ω–æ–≤–∞ –∞–∫—Ç–∏–≤–µ–Ω!`);
  renderArchive();
}


    renderArchive();
  </script>
</body>
</html>
